# **Spam Detector Service**

## üß© –û–ø–∏—Å–∞–Ω–∏–µ –ø—Ä–æ–µ–∫—Ç–∞

**Spam Detector Service** ‚Äî —ç—Ç–æ –ª—ë–≥–∫–∏–π –∏ —Ä–∞—Å—à–∏—Ä—è–µ–º—ã–π –º–∏–∫—Ä–æ—Å–µ—Ä–≤–∏—Å –¥–ª—è –∞–Ω–∞–ª–∏–∑–∞ —Ç–µ–∫—Å—Ç–æ–≤—ã—Ö —Å–æ–æ–±—â–µ–Ω–∏–π.
–û–Ω –ø—Ä–∏–Ω–∏–º–∞–µ—Ç —Ç–µ–∫—Å—Ç –∏ –Ω–∞–±–æ—Ä –ø—Ä–æ–≤–µ—Ä–æ–∫, –∫–æ—Ç–æ—Ä—ã–µ –Ω—É–∂–Ω–æ –≤—ã–ø–æ–ª–Ω–∏—Ç—å. –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Å—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –æ—Ç–≤–µ—Ç —Å —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞–º–∏.

–°–µ—Ä–≤–∏—Å —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω –Ω–∞ **FastAPI**, —Ä—Ä–∞–±–æ—Ç–∞–µ—Ç –∏–∑ –∫–æ—Ä–æ–±–∫–∏ —Å –ø–æ–º–æ—â—å—é **Docker**, –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ –Ω–æ–≤—ã—Ö –ø—Ä–æ–≤–µ—Ä–æ–∫ –∏ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é —á–µ—Ä–µ–∑ YAML.

---

# üìå –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏

* –í—ã–ø–æ–ª–Ω–µ–Ω–∏–µ –ø—Ä–æ–∏–∑–≤–æ–ª—å–Ω–æ–≥–æ –Ω–∞–±–æ—Ä–∞ –ø—Ä–æ–≤–µ—Ä–æ–∫ –ø–æ –∑–∞–ø—Ä–æ—Å—É
* –ú–∞—Å—à—Ç–∞–±–∏—Ä—É–µ–º—ã–π –Ω–∞–±–æ—Ä –ø—Ä–∞–≤–∏–ª (blacklist, —Å—Å—ã–ª–∫–∏, —Ç–µ–ª–µ—Ñ–æ–Ω—ã –∏ –¥—Ä.)
* –£–¥–æ–±–Ω—ã–π Swagger UI (`/docs`)
* –ë—ã—Å—Ç—Ä—ã–π –∑–∞–ø—É—Å–∫ —á–µ—Ä–µ–∑ Docker Compose
* Healthcheck –¥–ª—è –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞ —Å–æ—Å—Ç–æ—è–Ω–∏—è
* –ö–æ–Ω—Ñ–∏–≥—É—Ä–∏—Ä—É–µ–º—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –ø—Ä–æ–≤–µ—Ä–æ–∫

---

# üìÅ –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞

```
spam_detector_service/
‚îú‚îÄ‚îÄ Dockerfile
‚îú‚îÄ‚îÄ README.md
‚îú‚îÄ‚îÄ config.yaml
‚îú‚îÄ‚îÄ docker-compose.yml
‚îú‚îÄ‚îÄ requirements.txt
‚îî‚îÄ‚îÄ src
    ‚îú‚îÄ‚îÄ __init__.py
    ‚îú‚îÄ‚îÄ api.py
    ‚îú‚îÄ‚îÄ config.ini
    ‚îú‚îÄ‚îÄ core.py
    ‚îú‚îÄ‚îÄ main.py
    ‚îú‚îÄ‚îÄ schemas.py
    ‚îú‚îÄ‚îÄ services
    ‚îÇ   ‚îú‚îÄ‚îÄ __init__.py
    ‚îÇ   ‚îú‚îÄ‚îÄ checks.py
    ‚îÇ   ‚îî‚îÄ‚îÄ lib
    ‚îÇ       ‚îî‚îÄ‚îÄ __init__.py
    ‚îî‚îÄ‚îÄ utills
        ‚îî‚îÄ‚îÄ __init__.py
```

---

# ‚öôÔ∏è –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∏ –∑–∞–ø—É—Å–∫

## üîß –õ–æ–∫–∞–ª—å–Ω—ã–π –∑–∞–ø—É—Å–∫ –±–µ–∑ Docker

```bash
pip install -r requirements.txt
uvicorn src.main:app --reload
```

Swagger UI:
üëâ [http://localhost:8000/docs](http://localhost:8000/docs)

---

## üê≥ –ó–∞–ø—É—Å–∫ —á–µ—Ä–µ–∑ Docker Compose

```bash
docker compose up --build
```

–ï—Å–ª–∏ –≤—Å—ë —É—Å–ø–µ—à–Ω–æ ‚Äî —Å–µ—Ä–≤–∏—Å –±—É–¥–µ—Ç –¥–æ—Å—Ç—É–ø–µ–Ω –Ω–∞:

* API: [http://localhost:8000](http://localhost:8000)
* Swagger: [http://localhost:8000/docs](http://localhost:8000/docs)
* Healthcheck: [http://localhost:8000/health](http://localhost:8000/health)

---

# üîå API

## **POST** `/api/check`

–ó–∞–ø—Ä–æ—Å:

```json
{
  "text": "FREE viagra here! https://spammy.com",
  "recipients": ["user@example.com"],
  "checks": ["blacklist", "links", "phone"],
  "options": {
    "blacklist": {
      "params": {
        "words": ["free", "viagra", "casino"]
      }
    }
  }
}
```

–û—Ç–≤–µ—Ç:

```json
{
  "is_spam": true,
  "score": 0.5,
  "results": [
    {
      "name": "blacklist",
      "passed": false,
      "score": 0.66,
      "details": {
        "hits": ["free", "viagra"]
      }
    },
    {
      "name": "links",
      "passed": true,
      "score": 0.33,
      "details": {
        "links": ["https://spammy.com"],
        "count": 1,
        "max_links": 3
      }
    },
    {
      "name": "phone",
      "passed": false,
      "score": 1.0,
      "details": {
        "phones": ["+79991234567"]
      }
    }
  ]
}
```

---

# üß† –õ–æ–≥–∏–∫–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∏

## –°—Ö–µ–º–∞ —Ä–∞–±–æ—Ç—ã:

1. –ö–ª–∏–µ–Ω—Ç –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç —Ç–µ–∫—Å—Ç –∏ —Å–ø–∏—Å–æ–∫ –ø—Ä–æ–≤–µ—Ä–æ–∫.
2. `core.py` –≤—ã–∑—ã–≤–∞–µ—Ç –∫–∞–∂–¥—É—é –ø—Ä–æ–≤–µ—Ä–∫—É –∏–∑ `services/checks.py`.
3. –ö–∞–∂–¥–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –æ–±—ä–µ–∫—Ç `CheckResult`.
4. –°–µ—Ä–≤–∏—Å –∞–≥—Ä–µ–≥–∏—Ä—É–µ—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã:

   * `is_spam = any(not passed)`
   * `score = —Å—Ä–µ–¥–Ω–µ–µ –∑–Ω–∞—á–µ–Ω–∏–µ score –ø–æ –≤—Å–µ–º –ø—Ä–æ–≤–µ—Ä–∫–∞–º`
5. –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç `SpamResponse`.

---

# üîç –ü—Ä–æ–≤–µ—Ä–∫–∏ (rules)

## 1. **Blacklist words**

–ò—â–µ—Ç –∑–∞–ø—Ä–µ—â—ë–Ω–Ω—ã–µ —Å–ª–æ–≤–∞.

```python
check_blacklist_words()
```

–ü–∞—Ä–∞–º–µ—Ç—Ä—ã:

* `words: List[str]` ‚Äî —Å–ø–∏—Å–æ–∫ —Å–ª–æ–≤

---

## 2. **Links check**

–°—á–∏—Ç–∞–µ—Ç –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Å—Å—ã–ª–æ–∫ –≤ —Ç–µ–∫—Å—Ç–µ.

```python
check_links()
```

–ü–∞—Ä–∞–º–µ—Ç—Ä—ã:

* `max_links: int`

---

## 3. **Phone numbers check**

–ò—â–µ—Ç —Ç–µ–ª–µ—Ñ–æ–Ω—ã —Ñ–æ—Ä–º–∞—Ç–∞ `+7XXXXXXXXXX`.

```python
check_phone_numbers()
```

–ü–∞—Ä–∞–º–µ—Ç—Ä—ã:

* (–Ω–µ—Ç)

---

# üß© –ö–∞–∫ –¥–æ–±–∞–≤–∏—Ç—å –Ω–æ–≤—É—é –ø—Ä–æ–≤–µ—Ä–∫—É

–°–æ–∑–¥–∞—Ç—å —Ñ—É–Ω–∫—Ü–∏—é –≤ `src/services/checks.py`:

```python
def check_new_rule(text, recipients, params):
    return CheckResult(
        name="new_rule",
        passed=True/False,
        score=0‚Äì1,
        details={...}
    )
```

–ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞—Ç—å –µ—ë:

```python
AVAILABLE_CHECKS["new_rule"] = check_new_rule
```

–¢–µ–ø–µ—Ä—å –æ–Ω–∞ –¥–æ—Å—Ç—É–ø–Ω–∞ –∏–∑ API.

---

# üõ† –ö–æ–Ω—Ñ–∏–≥ (`config.yaml`)

–ü—Ä–∏–º–µ—Ä:

```yaml
checks:
  blacklist:
    words: ["free", "viagra"]
  links:
    max_links: 3
```

–°–µ—Ä–≤–∏—Å –º–æ–∂–µ—Ç –∑–∞–≥—Ä—É–∂–∞—Ç—å –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é –ø—Ä–∏ —Å—Ç–∞—Ä—Ç–µ (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ).

---

# üí° –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω—ã–µ –æ—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏

* –ø–æ–ª–Ω–æ—Å—Ç—å—é –º–æ–¥—É–ª—å–Ω—ã–π –¥–∏–∑–∞–π–Ω
* –ª—ë–≥–∫–æ–µ —Ä–∞—Å—à–∏—Ä–µ–Ω–∏–µ —á–µ—Ä–µ–∑ –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ –ø—Ä–æ–≤–µ—Ä–æ–∫
* –Ω–∏–∫–∞–∫–æ–π –ø—Ä–∏–≤—è–∑–∫–∏ –∫ –ë–î (–ø—Ä–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏ –ª–µ–≥–∫–æ –¥–æ–±–∞–≤–∏—Ç—å)
* –º–æ–∂–Ω–æ –ø–æ–¥–∫–ª—é—á–∏—Ç—å ML-–º–æ–¥–µ–ª—å –¥–ª—è —Å–∫–æ—Ä–∏–Ω–≥–∞

---

# ü§ù –ö–æ–Ω—Ç–∞–∫—Ç—ã / –ø–æ–¥–¥–µ—Ä–∂–∫–∞
[Telegram](https://t.me/sdg9999)